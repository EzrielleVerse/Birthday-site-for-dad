<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Dad</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --navy: #0a192f;
            --gold: #c5a059;
            --white: #ffffff;
            --cream: #f8f9fa;
        }

        body, html {
            margin: 0; padding: 0;
            background-color: var(--navy);
            color: var(--white);
            font-family: 'Montserrat', sans-serif;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            box-sizing: border-box;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        /* --- 1. THE CARD (Elegance) --- */
        .card-container {
            width: 320px; height: 460px;
            perspective: 1500px;
            cursor: pointer;
        }

        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .card-container.flipped .card-inner { transform: rotateY(-180deg); }

        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            border: 3px solid var(--gold);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }

        .card-front { background: var(--navy); background-image: radial-gradient(circle, #112240 1px, transparent 1px); background-size: 20px 20px; }
        .card-back { background: var(--white); color: var(--navy); transform: rotateY(180deg); padding: 30px; text-align: center; }

        /* --- 2. THE POLAROID SLIDESHOW --- */
        .polaroid-frame {
            background: white;
            padding: 15px 15px 60px 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: rotate(-2deg);
            transition: transform 0.3s;
            margin-bottom: 30px;
        }

        .polaroid-frame:hover { transform: rotate(0deg) scale(1.05); }

        .slideshow {
            width: 280px; height: 280px;
            position: relative; overflow: hidden;
            background: #eee;
        }

        .slide {
            position: absolute; width: 100%; height: 100%;
            object-fit: cover; opacity: 0; transition: opacity 1.5s ease-in-out;
        }

        .slide.active { opacity: 1; }

        /* --- 3. THE REALISTIC CAKE --- */
        .cake-area { height: 250px; display: flex; flex-direction: column-reverse; align-items: center; position: relative; }

        .layer {
            border-radius: 10px; opacity: 0;
            transform: translateY(50px) scale(0.5);
            animation: buildCake 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            box-shadow: inset 0 -5px rgba(0,0,0,0.2);
        }

        .l1 { width: 220px; height: 60px; background: #4e342e; animation-delay: 0.3s; } /* Chocolate */
        .l2 { width: 180px; height: 50px; background: #6d4c41; animation-delay: 1s; } 
        .l3 { width: 140px; height: 40px; background: #8d6e63; animation-delay: 1.7s; }
        
        .frosting-drip {
            width: 140px; height: 15px; background: #fff;
            border-radius: 10px 10px 0 0; opacity: 0;
            animation: buildCake 0.5s forwards 2.3s;
        }

        @keyframes buildCake { to { opacity: 1; transform: translateY(0) scale(1); } }

        .candle {
            width: 10px; height: 40px; background: repeating-linear-gradient(45deg, #fff, #fff 5px, var(--gold) 5px, var(--gold) 10px);
            position: absolute; bottom: 160px; opacity: 0;
            animation: buildCake 0.5s forwards 2.8s;
        }

        .flame {
            width: 16px; height: 24px; background: #ff5722;
            border-radius: 50% 50% 20% 20%; position: absolute;
            top: -24px; left: -3px; box-shadow: 0 0 20px #ffeb3b;
            animation: flicker 0.1s infinite alternate;
        }

        @keyframes flicker { from { transform: scale(1) rotate(-1deg); opacity: 0.8; } to { transform: scale(1.2) rotate(1deg); opacity: 1; } }

        /* --- 4. THE HANDWRITTEN LETTER --- */
        .letter-paper {
            background: #fff; color: #333;
            font-family: 'Dancing Script', cursive;
            padding: 50px; max-width: 600px;
            border-radius: 2px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            position: relative;
            line-height: 1.8; font-size: 1.8rem;
        }

        .btn {
            background: var(--gold); color: white;
            padding: 15px 30px; border: none; border-radius: 50px;
            font-family: 'Montserrat', sans-serif; font-weight: 700;
            text-transform: uppercase; letter-spacing: 2px;
            cursor: pointer; transition: 0.3s; margin-top: 30px;
        }

        .btn:hover { background: #b38f4d; transform: translateY(-3px); }
    </style>
</head>
<body>

    <section id="step1">
        <div class="card-container" onclick="this.classList.toggle('flipped')">
            <div class="card-inner">
                <div class="card-front">
                    <h1 style="font-size: 1rem; letter-spacing: 5px; color: var(--gold);">PRIVATE MESSAGE</h1>
                    <h2 style="font-size: 2.5rem; margin: 10px 0;">FOR DAD</h2>
                    <div style="width: 50px; height: 2px; background: var(--gold);"></div>
                </div>
                <div class="card-back">
                    <h2 style="margin-top: 0;">Happy Birthday, Dad!</h2>
                    <p>I built this small digital world to celebrate you.</p>
                    <button class="btn" onclick="next(event, 'step2')">Carry On!</button>
                </div>
            </div>
        </div>
    </section>

    <section id="step2">
        <h2 style="margin-bottom: 40px; color: var(--gold);">Fine Man üôÇ‚Äç‚Üî...</h2>
        <div class="polaroid-frame">
            <div class="slideshow">
                <img src="dad1.jpg" class="slide active">
                <img src="dad2.jpg" class="slide">
                <img src="dad3.jpg" class="slide">
            </div>
        </div>
        <button class="btn" onclick="next(event, 'step3')">Continue</button>
    </section>

    <section id="step3">
        <div class="cake-area">
            <div class="layer l1"></div>
            <div class="layer l2"></div>
            <div class="layer l3"></div>
            <div class="frosting-drip"></div>
            <div class="candle">
                <div class="flame" id="flame"></div>
            </div>
        </div>
        <h2 id="cake-status" style="margin-top: 60px;">Make a wish, Dad.</h2>
        <p id="instruction">Blow into the microphone to blow out the candle.</p>
        <button class="btn" id="micBtn" onclick="initMic()">I'm Ready to Blow</button>
        <button class="btn" id="letterBtn" style="display:none" onclick="next(event, 'step4')">Read My Message</button>
    </section>

    <section id="step4" style="background: var(--cream);">
        <div class="letter-paper">
            Dear Dad,<br><br>
            Thank you for being the foundation of our family. I am so proud to be your child. As you celebrate today, know that your best years are still unfolding.<br><br>
            May your days be filled with health, peace, and the same joy you've given us all these years.<br><br>
            Happy Birthday!<br>
            With love,
            Favour.
        </div>
    </section>

    <script>
        function next(e, id) {
            e.stopPropagation();
            document.getElementById(id).scrollIntoView({behavior: 'smooth'});
        }

        // --- Improved Slideshow ---
        let sIdx = 0;
        const slides = document.querySelectorAll('.slide');
        setInterval(() => {
            slides[sIdx].classList.remove('active');
            sIdx = (sIdx + 1) % slides.length;
            slides[sIdx].classList.add('active');
        }, 4000);

        // --- Mic & Confetti Logic ---
        function initMic() {
            document.getElementById('micBtn').innerText = "Mic Active - Blow Now!";
            navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
                const ctx = new AudioContext();
                const analyzer = ctx.createAnalyser();
                const src = ctx.createMediaStreamSource(stream);
                src.connect(analyzer);
                const data = new Uint8Array(analyzer.frequencyBinCount);

                function check() {
                    analyzer.getByteFrequencyData(data);
                    let vol = data.reduce((a, b) => a + b) / data.length;
                    
                    if (vol > 50) { // Detection threshold
                        document.getElementById('flame').style.display = 'none';
                        document.getElementById('cake-status').innerText = "WISH GRANTED!";
                        document.getElementById('cake-status').style.color = "#c5a059";
                        document.getElementById('instruction').style.display = 'none';
                        document.getElementById('micBtn').style.display = 'none';
                        document.getElementById('letterBtn').style.display = 'inline-block';
                        
                        // Premium Confetti
                        var count = 200;
                        var defaults = { origin: { y: 0.7 } };

                        function fire(particleRatio, opts) {
                          confetti(Object.assign({}, defaults, opts, {
                            particleCount: Math.floor(count * particleRatio)
                          }));
                        }

                        fire(0.25, { spread: 26, startVelocity: 55 });
                        fire(0.2, { spread: 60 });
                        fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
                        fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
                        fire(0.1, { spread: 120, startVelocity: 45 });
                        
                        stream.getTracks().forEach(t => t.stop());
                    } else {
                        requestAnimationFrame(check);
                    }
                }
                check();
            }).catch(() => alert("Please enable mic to blow the candle!"));
        }
    </script>
</body>
</html>
